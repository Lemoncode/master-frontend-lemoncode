# Map Background Scale

After the Eurobasket 2022 final, our boss asked us to implement a map that colours each european country depending on their final position in the above mentioned competition.

![Final standings Eurobasket 2022](./content/chart.png)

# Steps

- We will take as starting point our previous example: _00-render-map-hover_ let's copy
  the content and execute _npm start_

```bash
npm start
```

We have the following information

| Country               | Result         |
| --------------------- | :------------: |
| Spain                 | champion       |
| France                | runner-up      |
| Germany               | bronze         |
| Poland                | semifinals     |
| Greece                | quarterfinals  |
| Slovenia              | quarterfinals  |
| Italy                 | quarterfinals  |
| Finland               | quarterfinals  |
| Serbia                | knockout-stage |
| Ukraine               | knockout-stage |
| Croatia               | knockout-stage |
| Montenegro            | knockout-stage |
| Belgium               | knockout-stage |
| Lithuania             | knockout-stage |
| CzechRepublic         | knockout-stage |
| BosniaandHerzegovina  | group-stage    |
| Estonia               | group-stage    |
| Bulgaria              | group-stage    |
| Netherlands           | group-stage    |
| Hungary               | group-stage    |
| UnitedKingdom         | group-stage    |
| Russia                | DSQ            |
| Belarus               | DSQ            |

- Let's port it to json (respecting the name of the countries that we are using in our eurobasket map)

_./src/stats.ts_

```typescript
export const finalStandingsEurobasket2022 = [
  { country: "Spain", result: "champion" },
  { country: "France", result: "runner-up" },
  { country: "Germany", result: "bronze" },
  { country: "Poland", result: "semifinals" },
  { country: "Greece", result: "quarterfinals" },
  { country: "Slovenia", result: "quarterfinals" },
  { country: "Italy", result: "quarterfinals" },
  { country: "Finland", result: "quarterfinals" },
  { country: "Serbia", result: "knockout-stage" },
  { country: "Ukraine", result: "knockout-stage" },
  { country: "Croatia", result: "knockout-stage" },
  { country: "Montenegro", result: "knockout-stage" },
  { country: "Belgium", result: "knockout-stage" },
  { country: "Lithuania", result: "knockout-stage" },
  { country: "CzechRepublic", result: "knockout-stage" },
  { country: "BosniaandHerzegovina", result: "group-stage" },
  { country: "Estonia", result: "group-stage" },
  { country: "Bulgaria", result: "group-stage" },
  { country: "Netherlands", result: "group-stage" },
  { country: "Hungary", result: "group-stage" },
  { country: "UnitedKingdom", result: "group-stage" },
  { country: "Russia", result: "DSQ" },
  { country: "Belarus", result: "DSQ" },
];

```

- Let's import the new set of data into our _index.ts_ file. We are going to import the new map _eurobasket.json_, which is quite similar to _europe.json_ but with some minor differences:

_./src/index.ts_

```diff
- const europejson = require("./europe.json");
+ const europejson = require("./eurobasket.json");
+ import { finalStandingsEurobasket2022 } from "./stats";
```

- Now we are going to assign a range of colores for our domain:

_./src/index.ts_

```diff
import { finalStandingsEurobasket2022 } from "./stats";

+ // set the affected color scale
+ const color = d3
+   .scaleOrdinal([
+     "gold",
+     "silver",
+     "#b58e4e", //bronze
+     "#006400",
+     "#6D9062",
+     "#DFF8D5",
+     "#74B2DF",
+     "black",
+   ])
+   .domain([
+     "champion",
+     "runner-up",
+     "bronze",
+     "semifinals",
+     "quarterfinals",
+     "knockout-stage",
+     "group-stage",
+     "DSQ",
+   ]);
```

We are using a color palette generated by [mycolor.space](https://mycolor.space/?hex=%23006400&sub=1):

![Color palette used](content/palette.png)

- Let's create a help function to map from country to color: we have to take into account that some European countries didn't qualify to the Eurobasket 2022 (they don't exist on our list).

```diff
const color = d3
  .scaleOrdinal([
    "gold",
    "silver",
    "#b58e4e", //bronze
    "#006400",
    "#6D9062",
    "#DFF8D5",
    "#74B2DF",
    "black",
  ])
  .domain([
    "champion",
    "runner-up",
    "bronze",
    "semifinals",
    "quarterfinals",
    "knockout-stage",
    "group-stage",
    "DSQ",
  ]);

+ const assignCountryBackgroundColor = (countryName: string) => {
+  const item = finalStandingsEurobasket2022.find(
+    item => item.country === countryName
+  );
+  return item ? color(item.result) : "white";
+ };
```

- Before modifying our svg, the css file _map.css_ has to be updated:

```diff
.country {
  stroke-width: 1;
  stroke: #2f4858;
- fill: #008c86;
}

.selected-country {
  stroke-width: 1;
  stroke: #bc5b40;
- fill: #f88f70;
}
```

- Let's add a fill style to match country name with corresponding background color, using the function defined previously:

```diff
svg
  .selectAll("path")
  .data(geojson["features"])
  .enter()
  .append("path")
  .attr("class", "country")
+ .style("fill", function(d: any) {
+   return assignCountryBackgroundColor(d.properties.geounit);
+ })
  // data loaded from json file
  .attr("d", geoPath as any)
```

- Now it's time to modify mouseout and mouseover render features. In this case we will add a tooltip when mouse is over a country, which is going to display the name and final position of that country:

```diff
+ // Define the div for the tooltip
+ const div = d3
+   .select("body")
+   .append("div")
+   .attr("class", "tooltip")
+   .style("opacity", 0);

svg
  .selectAll("path")
  .data(geojson["features"])
  .enter()
  .append("path")
  .attr("class", "country")
  .style("fill", function (d: any) {
    return assignCountryBackgroundColor(d.properties.geounit);
  }
  // data loaded from json file
  .attr("d", geoPath as any)
- .on("mouseover", function(d, i) {
+ .on("mouseover", function (mouseEvent: MouseEvent, datum: any) {
    d3.select(this).attr("class", "selected-country");
+   const country = datum.properties.geounit;
+   const item = finalStandingsEurobasket2022.find(
+     (item) => item.country === country
+   );
+   const countryResult = item ? item.result : "DNQ";
+
+   const coords = { x: mouseEvent.pageX, y: mouseEvent.pageY };
+   div.transition().duration(200).style("opacity", 0.9);
+   div
+     .html(`<span>${country}: ${countryResult}</span>`)
+     .style("left", `${coords.x}px`)
+     .style("top", `${coords.y - 28}px`);
  })
  .on("mouseout", function(d, i) {
    d3.select(this).attr("class", "country");
+   div.transition()
+     .duration(500)
+     .style("opacity", 0);
  });
```

- This new div element requires some styling. Let's create a new css file, _./src/styles.css_ with the content below:

```css
div.tooltip {
  position: absolute;
  text-align: center;
  width: 70px;
  height: 28px;
  padding: 2px;
  font: 12px sans-serif;
  background: #f7f2cb;
  border: 0px;
  border-radius: 8px;
  pointer-events: none;
}
```

- And import this new css file in our html file _index.html_:

```diff
  <link rel="stylesheet" type="text/css" href="./map.css" />
+ <link rel="stylesheet" type="text/css" href="./styles.css" />
  <link rel="stylesheet" type="text/css" href="./base.css" />
```

- Let's give a try

```bash
npm start
```

# About Basefactor + Lemoncode

We are an innovating team of Javascript experts, passionate about turning your ideas into robust products.

[Basefactor, consultancy by Lemoncode](http://www.basefactor.com) provides consultancy and coaching services.

[Lemoncode](http://lemoncode.net/services/en/#en-home) provides training services.

For the LATAM/Spanish audience we are running an Online Front End Master degree, more info: http://lemoncode.net/master-frontend
